Знакомство с Cross-Site Scripting (XSS) 

Межсайтовый скриптинг или XSS представляет собой атаку с внедрением кода на 
стороне клиента, при которой вредоносные скрипты внедряются на надежные веб-
сайты. XSS осуществляется в тех веб-приложениях, где входные параметры не были 
должным образом настроены или проверены, что позволяет злоумышленнику 
отправлять вредоносные коды Javascript другому конечному пользователю. Браузер 
конечного пользователя не имеет возможности узнать, что скрипту не следует 
доверять, и, таким образом, выполнит его. 
В этой атаке пользователи не компрометируются непосредственно через полезную 
нагрузку, хотя злоумышленник снимает уязвимость XSS, вставляя вредоносный 
скрипт на веб-страницу, которая кажется подлинной частью веб-сайта. Таким 
образом, когда любой пользователь посещает этот веб-сайт, “болеющая” веб-
страница XSS доставит вредоносный код JavaScript непосредственно в браузер без 
его ведома. 

Влияние Cross-Site Scripting 

За последнее столетие межсайтовый скриптинг сумел занять свое место в списке 
OWASP Top10, поскольку это один из самых важных и наиболее широко 
используемых методов атаки в Интернете. 
За счет него злоумышленник способен выполнить следующее: 
Захватить и получить доступ с проверкой подлинности пользователя и куки 
сессии 
Загрузить фишинговую страницу, чтобы заманить пользователей и завладеть их 
данными 
Перенаправить посетителей на другие вредоносные ресурсы 
Раскрыть конфиденциальные данные пользователей 
Манипулировать структурой веб-приложения 
Тем не менее, XSS был зарегистрирован с оценкой CVSS 6.1 и средней степенью 
опасности. 
CWE-79: неверная нейтрализация входных данных во время генерации веб-
страниц (“Межсайтовый скриптинг”) 
CWE-80: неверная нейтрализация HTML-тегов, связанных со сриптами, на веб-
странице (Basic XSS)

Типы XSS 

До сих пор у пользователя, возможно, было четкое понимание концепции JavaScript 
и XSS и их основных последствий. Итак, стоит продолжить идти по той же дороге и 
разбить XSS на три основных типа: 
- Stored XSS Reflected 
- XSS DOM-based XSS
- DOM-based XSS 

Stored XSS 

Stored XSS еще называется персистентным XSS или I типом, так как с помощью этой
уязвимости внедренный вредоносный скрипт постоянно хранится внутри сервера 
базы данных веб-приложения, а сервер далее сбрасывает его обратно, когда 
пользователь посещает соответствующий веб-сайт. 
Это происходит, когда клиент нажимает или наводит курсор на определенный 
зараженный раздел. Введенный JavaScript будет выполняться браузером так же, как
он записан в базе данных приложения, поэтому эта атака не требует какой-либо 
фишинговой техники для осуществления в отношении пользователей.
Наиболее распространенным примером Stored XSS является «опция 
комментариев» в блогах, которая позволяет любому пользователю оставлять свои 
отзывы как в виде послания для администратора, так и для других пользователей. 

Reflected XSS
 
Reflected XSS, еще называемый неперсистентным XSS или типом II, появляется, 
когда веб-приложение немедленно реагирует на ввод пользователя без проверки 
того, что ввел пользователь. Это может привести к тому, что злоумышленник введет 
исполняемый код браузера в один HTML-ответ. Он называется «неперсистентным», 
так как вредоносный скрипт не хранится в базе данных веб-сервера, поэтому 
злоумышленнику необходимо отправить вредоносную ссылку с помощью фишинга, 
чтобы поймать пользователя в ловушку. 
Reflected XSS является распространенной практикой, поэтому может быть легко 
найден в “полях поиска веб-сайта”, где злоумышленник включает некоторые 
произвольные коды Javascript в текстовое поле поиска, и, если сайт уязвим, веб-
страница возвращает событие, как было описано в скрипте. 
Reflected XSS бывает двух типов: 

- Reflected XSS GET 
- Reflected XSS POST 

DOM-Based XSS 

Межсайтовые скрипты на основе DOM – это уязвимость, которая появляется в 
объектной модели документа, а не на HTML-страницах. 
Но что такое эта объектная модель документа? 
DOM или объектная модель документа описывает различные сегменты веб-
страницы, такие как заголовок, таблицы, формы и даже иерархическую структуру 
HTML-страницы. Таким образом, этот API повышает квалификацию разработчиков 
по созданию и изменению HTML и XML-документов в качестве объектов 
программирования. 
Когда HTML-документ загружается в веб-браузере, он становится “объектом 
документа”. 
Однако этот объект документа является корневым узлом HTML-документов и 
владеет всеми остальными узлами.

С помощью объектной модели JavaScript получает все необходимое для создания 
динамического HTML: 
- JavaScript может изменять все HTML-элементы на странице 
- JavaScript способен изменять все атрибуты HTML 
- JavaScript может изменять стили CSS на странице
- JavaScript способен удалять существующие HTML-элементы и атрибуты
- JavaScript может добавлять новые HTML-элементы и атрибуты 
- JavaScript способен реагировать на все существующие HTML-события на 
странице 
- JavaScript может создавать новые HTML-события 

Поэтому манипуляция DOM сама по себе не является проблемой, но когда 
JavaScript обрабатывает данные небезопасно в DOM, таким образом, он позволяет 
проводить различные атаки. 
Уязвимости XSS на основе DOM обычно появляются, когда JavaScript берет данные 
из контролируемого злоумышленником источника, такого как URL, и передает их 
приемнику (опасная функция JavaScript), который поддерживает динамическое 
выполнение кода. 
Этим он сильно отличается от Reflected и Stored XSS, потому что в данной атаке 
разработчик не может найти вредоносный скрипт в исходном коде HTML, а также в 
ответе HTML, его можно наблюдать только во время выполнения. 
XSS на основе DOM использует эти уязвимости на локальных компьютерах 
пользователя следующим образом: 
- Злоумышленник создает вредоносный веб-сайт 
- Пользователь открывает его 
- У него есть уязвимая страница на компьютере 
- Сайт злоумышленника отправляет команды на уязвимую HTML-страницу
- Уязвимая локальная страница выполняет эти команды с правами пользователя на 
этой машине 
- Злоумышленник получает контроль над компьютером жертвы 

Использование Cross-Site Scripting 

Пользователь может задаться вопросом: “Хорошо, мы получили всплывающее окно, 
но что теперь? Что мы можем сделать с ним? Я нажму на кнопку ОК, и это 
всплывающее окно исчезнет”. 
Но это всплывающее окно говорит о тысяче возможных способов. Нужно вернуться 
к тому месту, где пользователь увидел первое всплывающее окно. 

Получение учетных данных 

Пользователь теперь знает том, что всякий раз, когда он отправляет свой отзыв, 
фидбэк будет храниться непосредственно в базе данных сервера. И если 
злоумышленник манипулирует обратной связью с помощью “предупреждающего 
сообщения”, то даже само предупреждение будет сохранено в нем, ведь оно 
всплывает каждый раз, когда какой-то другой пользователь посещает веб-страницу 
приложения. 
Но что делать, если вместо всплывающего окна пользователя приветствует 
страница входа в систему? 
Необходимо попробовать решить эту проблему, введя вредоносную полезную 
нагрузку, которая создаст поддельную форму входа пользователя на веб-странице, 
что, таким образом, переадресует захваченный запрос на IP-адрес 
злоумышленника. 

Захват Cookie 

Бывают случаи, когда злоумышленнику нужны аутентифицированные файлы cookie 
вошедшего в систему пользователя либо для доступа к его учетной записи, либо для
какой-то другой вредоносной цели. 
Итак, стоит рассмотреть, как эта уязвимость XSS позволяет злоумышленникам 
захватывать сеансовые файлы cookie и как они злоупотребляют ими, чтобы 
добраться до учетной записи пользователя. 
Человек запустил уязвимое веб-приложение “DVWA” в своем браузере и вошел с 
помощью admin: password. Далее, на левой панели он выбрал уязвимость как XSS 
(Stored), но, на этот раз, поставил низкие параметры безопасности.

Использование атаки вместе с Burpsuite 

Stored XSS трудно найти, но, с другой стороны, Reflected XSS очень распространен 
и поэтому может быть использован с помощью нескольких простых щелчков мыши. 
Но до сих пор пользователь применял только веб-приложения, которые не были 
проверены разработчиками, так что же насчет тех, которые защищены? 
Веб-приложения с полями ввода где-то уязвимы для XSS, но пользователю стоит 
подумать, были ли они защищены определенными проверками. Поэтому для того, 
чтобы использовать такие защищенные приложения, нужны некоторые 
инструменты, здесь можно рассчитывать на BurpSuite. 
Пользователь открыл целевой IP в своем браузере и вошел в систему BWAPP как 
bee:bug, далее он установил опцию “Choose Your Bug” на “XSS-Reflected (Post)” и 
запустил кнопку hack. Для этого раздела был установлен средний уровень 
безопасности.

XSSer
 
Межсайтовый “скриптер” или “XSSer” – это платформа, которая обнаруживает 
уязвимости XSS в веб-приложениях и даже предоставляет несколько вариантов их 
использования. 
XSSer имеет более 1300 предустановленных векторов XSS fuzzing, которые, таким 
образом, позволяют злоумышленнику обойти определенно отфильтрованные веб-
приложения и межсетевые экраны WAF (Web Application Firewalls). 
Итак, стоит понять, как этот fuzzer может помочь в использовании веб-приложения 
bWAPP. Но для того, чтобы двигаться дальше, нужно клонировать XSSer в машину 
Кали пользователя. Это можно сделать с помощью:

git clone https://github.com/epsylon/xsser.git

Теперь стоит загрузиться обратно в свой bWAPP, установить опцию “Choose your 
Bug” на “XSS –Reflected (Get)” и нажать на кнопку hack. На этот раз будет 
установлен средний уровень безопасности.

Лучшее в этом fuzzer то, что он предоставляет URL-адрес браузера. 
Примечание: Нет необходимости с каждой полезной нагрузкой получать 
всплывающее предупреждение, так как каждая другая полезная нагрузка 
определяется каким-то конкретным событием, будь то настройка iframe, захват 
некоторых файлов cookie или перенаправление на какой-то другой веб-сайт.

Митигирование
 
Разработчики должны внедрить белый список допустимых входных данных, и 
если это невозможно, то нужно организовать проверки входных данных. Более 
того, данные, введенные пользователем, должны быть отфильтрованы 
Output encoding является наиболее надежным решением для борьбы с XSS, 
поскольку оно принимает код скрипта и преобразует его в обычный текст
Межсетевой экран WAF должен активирован, поскольку он защищает 
приложение от XSS-атак 
Использование флагов HTTPOnly на файлах cookie 
Разработчики могут применить политику безопасности контента (CSP) для 
снижения возможности появления любых уязвимостей XSS


оригинал https://www.hackingarticles.in/comprehensive-guide-on-cross-site-scripting-xss/ 


решение задачи на портсвигере 

url#<img src=x onerror=alert(document.domain)>

<iframe src=«https://0a7f00dd04bd05508163d09d005200a6.web-security-academy.net/#» onload=«this.src+=‘<img src=x onerror=print()>’»>

